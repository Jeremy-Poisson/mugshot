<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wake County Mugshot Challenge</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      max-width: 900px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    header {
      text-align: center;
      padding: 20px 0;
    }

    h1 {
      font-size: 2.8rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #f8f9fa, #e9ecef);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .subtitle {
      color: #a9a9b3;
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .game-container {
      background: rgba(30, 30, 46, 0.8);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      position: relative;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      background: rgba(10, 10, 20, 0.6);
      padding: 15px 20px;
      border-radius: 12px;
    }

    .score-container {
      display: flex;
      gap: 25px;
    }

    .score-box {
      text-align: center;
      padding: 12px 20px;
      background: rgba(25, 25, 45, 0.8);
      border-radius: 10px;
      min-width: 120px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .score-label {
      font-size: 0.9rem;
      color: #8a8aa3;
      margin-bottom: 5px;
    }

    .score-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: #4cc9f0;
    }

    .streak {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.1rem;
      color: #ffd166;
    }

    .game-content {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .mugshot-container {
      position: relative;
      overflow: hidden;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
      max-width: 500px;
      margin: 0 auto;
      height: 500px;
      background: #0d0d1a;
      display: flex;
      flex-direction: column;
    }

    .suspect-name {
      background: rgba(0, 0, 0, 0.7);
      padding: 15px 20px;
      font-size: 1.4rem;
      text-align: center;
      font-weight: 600;
      letter-spacing: 0.5px;
      color: #f8f9fa;
      border-bottom: 2px solid #ff3860;
    }

    #mugshot {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.3s ease;
    }

    .mugshot-container:hover #mugshot {
      transform: scale(1.03);
    }

    .choices-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 15px;
    }

    .choice-btn {
      padding: 16px;
      background: rgba(40, 40, 70, 0.8);
      color: #f1f1f1;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 80px;
    }

    .choice-btn:hover {
      background: rgba(60, 60, 100, 0.9);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .choice-btn.correct {
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      color: white;
    }

    .choice-btn.incorrect {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 25px;
      flex-wrap: wrap;
    }

    .powerup {
      padding: 12px 25px;
      border-radius: 50px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .powerup i {
      font-size: 1.2rem;
    }

    .powerup:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }

    .powerup:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #eliminate {
      background: linear-gradient(135deg, #ff9a00, #ff6a00);
      color: white;
    }

    #hint {
      background: linear-gradient(135deg, #00c9ff, #0077ff);
      color: white;
    }

    .progress-container {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 20px;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff3860, #ff7a00);
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 40px;
      text-align: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.1);
      border-top: 5px solid #4cc9f0;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      background: rgba(25, 25, 45, 0.95);
      border-radius: 10px;
      border-left: 4px solid #ff3860;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transform: translateX(110%);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      border-left-color: #2ecc71;
    }

    .notification .title {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 1.1rem;
    }
    
    .disclaimer {
      font-size: 0.8rem;
      color: #a9a9b3;
      margin-top: 20px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      text-align: center;
      line-height: 1.5;
    }
    
    .loading-more {
      text-align: center;
      padding: 20px;
      display: none;
    }
    
    .game-stats {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      color: #a9a9b3;
      font-size: 0.9rem;
    }
    
    .streak-multiplier {
      position: absolute;
      top: -15px;
      right: 20px;
      background: linear-gradient(135deg, #ff9a00, #ff3860);
      padding: 8px 15px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 1.1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      display: none;
    }
    
    .multiplier-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      background: rgba(25, 25, 45, 0.95);
      padding: 20px 30px;
      border-radius: 15px;
      border: 2px solid #4cc9f0;
      font-size: 3rem;
      font-weight: bold;
      z-index: 2000;
      color: #ffd166;
      text-align: center;
      transition: transform 0.3s ease, opacity 0.3s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    .multiplier-popup.show {
      transform: translate(-50%, -50%) scale(1);
      animation: pulse 0.5s ease-in-out;
    }
    
    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
    
    .streak-fire {
      position: absolute;
      top: -20px;
      right: 100px;
      font-size: 1.8rem;
      color: #ff3860;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .streak-fire.show {
      opacity: 1;
      animation: fire 0.5s ease-in-out;
    }
    
    @keyframes fire {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    
    /* Game Over Screen */
    .game-over-screen {
      display: none;
      text-align: center;
      padding: 40px;
      background: rgba(30, 30, 46, 0.9);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .game-over-screen h2 {
      font-size: 3rem;
      margin-bottom: 20px;
      background: linear-gradient(90deg, #ff3860, #ff7a00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .final-score {
      font-size: 4rem;
      color: #4cc9f0;
      margin: 20px 0;
      text-shadow: 0 0 10px rgba(76, 201, 240, 0.5);
    }

    .restart-btn {
      padding: 15px 40px;
      background: linear-gradient(135deg, #4cc9f0, #3a86ff);
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      margin-top: 30px;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .restart-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 20px rgba(76, 201, 240, 0.4);
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .game-header {
        flex-direction: column;
        gap: 15px;
      }
      
      .score-container {
        width: 100%;
        justify-content: center;
      }
      
      .choices-container {
        grid-template-columns: 1fr;
      }
      
      .mugshot-container {
        height: 400px;
      }
      
      h1 {
        font-size: 2.4rem;
      }
      
      .game-over-screen h2 {
        font-size: 2.4rem;
      }
      
      .final-score {
        font-size: 3rem;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 2rem;
      }
      
      .score-box {
        min-width: 100px;
        padding: 10px 15px;
      }
      
      .score-value {
        font-size: 1.5rem;
      }
      
      .suspect-name {
        font-size: 1.2rem;
        padding: 12px 15px;
      }
      
      .powerup {
        padding: 10px 15px;
        font-size: 0.9rem;
      }
      
      .choice-btn {
        min-height: 70px;
        padding: 12px;
      }
      
      .streak-multiplier {
        top: -10px;
        right: 10px;
        font-size: 0.9rem;
        padding: 5px 10px;
      }
      
      .game-over-screen h2 {
        font-size: 2rem;
      }
      
      .final-score {
        font-size: 2.5rem;
      }
      
      .restart-btn {
        padding: 12px 30px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Wake County Mugshot Challenge</h1>
      <p class="subtitle">Can you guess the crime? Test your detective skills by matching mugshots to charges.</p>
    </header>
    
    <div class="game-container">
      <div class="streak-multiplier" id="streak-multiplier">
        <i class="fas fa-bolt"></i> <span id="multiplier-value">1x</span>
      </div>
      <div class="streak-fire" id="streak-fire"><i class="fas fa-fire"></i></div>
      
      <div class="game-header">
        <div class="score-container">
          <div class="score-box">
            <div class="score-label">SCORE</div>
            <div class="score-value" id="score">0</div>
          </div>
          <div class="score-box">
            <div class="score-label">STREAK</div>
            <div class="score-value" id="streak-value">0</div>
          </div>
        </div>
        
        <div class="streak">
          <i class="fas fa-fire"></i>
          <span id="streak-text">No streak yet</span>
        </div>
      </div>
      
      <div class="game-stats">
        <div>Mugshots: <span id="mugshot-count">0</span>/20</div>
        <div>Page: <span id="current-page">1</span>/<span id="total-pages">?</span></div>
      </div>
      
      <div class="game-content">
        <div class="mugshot-container">
          <div class="suspect-name" id="suspect-name">Loading suspect...</div>
          <img id="mugshot" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300' viewBox='0 0 400 300'%3E%3Crect width='400' height='300' fill='%23222'/%3E%3Ccircle cx='200' cy='120' r='60' fill='%23333'/%3E%3Crect x='140' y='200' width='120' height='80' fill='%23333'/%3E%3C/svg%3E" alt="Mugshot">
        </div>
        
        <div class="choices-container" id="choices">
          <div class="loading">
            <div class="spinner"></div>
            <p>Loading game data...</p>
          </div>
        </div>
        
        <div class="controls">
          <button class="powerup" id="eliminate" disabled>
            <i class="fas fa-ban"></i>
            Eliminate Two Options
          </button>
          <button class="powerup" id="hint" disabled>
            <i class="fas fa-lightbulb"></i>
            Get a Hint
          </button>
        </div>
        
        <div class="progress-container">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <div class="loading-more" id="loading-more">
          <div class="spinner"></div>
          <p>Loading more mugshots...</p>
        </div>
        
        <div class="disclaimer">
          The mugshots and arrest information presented on this site are public records. All individuals featured are presumed innocent until proven guilty in a court of law. This website is intended for informational and entertainment purposes only.
        </div>
      </div>
    </div>
    
    <!-- Game Over Screen -->
    <div class="game-over-screen" id="game-over">
      <h2>Game Over!</h2>
      <p>You've completed 20 mugshots</p>
      <div class="final-score" id="final-score">0</div>
      <p>Thanks for playing!</p>
      <button class="restart-btn" id="restart-btn">
        <i class="fas fa-redo"></i> Play Again
      </button>
    </div>
    
    <div class="notification" id="notification">
      <div class="title">Correct!</div>
      <div class="message">+1 point added to your score</div>
    </div>
    
    <div class="multiplier-popup" id="multiplier-popup">2x!</div>
  </div>

  <script>
    // Game constants
    const TOTAL_MUGSHOTS = 20;  // Game ends after this many mugshots
    
    // Game state
    let mugshots = [];
    let current = 0;
    let score = 0;
    let streak = 0;
    let streakMultiplier = 1;
    let usedEliminate = false;
    let gameStarted = false;
    let uniqueCrimes = new Set();
    let currentPage = 1;
    let totalPages = 1;
    let mugshotsShown = 0;  // Track how many mugshots have been shown

    // DOM elements
    const scoreEl = document.getElementById('score');
    const streakValueEl = document.getElementById('streak-value');
    const streakTextEl = document.getElementById('streak-text');
    const choicesEl = document.getElementById('choices');
    const mugshotEl = document.getElementById('mugshot');
    const nameEl = document.getElementById('suspect-name');
    const eliminateBtn = document.getElementById('eliminate');
    const hintBtn = document.getElementById('hint');
    const notificationEl = document.getElementById('notification');
    const progressBar = document.getElementById('progress-bar');
    const loadingMoreEl = document.getElementById('loading-more');
    const mugshotCountEl = document.getElementById('mugshot-count');
    const currentPageEl = document.getElementById('current-page');
    const totalPagesEl = document.getElementById('total-pages');
    const multiplierEl = document.getElementById('streak-multiplier');
    const multiplierValueEl = document.getElementById('multiplier-value');
    const multiplierPopup = document.getElementById('multiplier-popup');
    const streakFire = document.getElementById('streak-fire');
    const gameOverEl = document.getElementById('game-over');
    const finalScoreEl = document.getElementById('final-score');
    const restartBtn = document.getElementById('restart-btn');

    // Simplified charge mapping
    const simplifiedCharges = {
      "FTA": "Failure to Appear in Court",
      "VOC": "Violation of Court Order",
      "DV": "Domestic Violence",
      "PWIMSD": "Possession With Intent to Sell",
      "CS": "Controlled Substance",
      "MISD": "Misdemeanor",
      "FELONY": "Felony",
      "LARCENY": "Theft",
      "TRESPASS": "Trespassing",
      "ASSAULT": "Assault",
      "BURGLARY": "Burglary",
      "PROBATION": "Probation Violation",
      "DUI": "Driving Under Influence",
      "FTA-BREAKING": "Failure to Appear for Breaking/Entering",
      "SHOPLIFTING": "Shoplifting",
      "FRAUD": "Fraud",
      "RESISTING": "Resisting Arrest",
      "BATTERY": "Battery",
      "STALKING": "Stalking",
      "FORGERY": "Forgery",
      "EMBEZZLEMENT": "Embezzlement",
      "VANDALISM": "Vandalism",
      "ROBBERY": "Robbery",
      "KIDNAPPING": "Kidnapping",
      "ARSON": "Arson"
    };

    // Famous arrests for hints
    const famousArrests = {
      "DUI": "Tiger Woods (2009)",
      "Theft": "Winona Ryder (2001)",
      "Assault": "Chris Brown (2009)",
      "Drug Possession": "Robert Downey Jr. (1996)",
      "Fraud": "Jordan Belfort (1998)",
      "Burglary": "Paris Hilton (2010)",
      "Public Intoxication": "Justin Bieber (2014)",
      "Reckless Driving": "Amanda Bynes (2012)",
      "Trespass": "Kanye West (2013)",
      "Shoplifting": "Lindsay Lohan (2011)",
      "Resisting": "DMX (2016)",
      "Larceny": "Mike Tyson (2003)"
    };

    // Simulate loading progress
    function simulateProgress() {
      let width = 0;
      const interval = setInterval(() => {
        if (width >= 100) {
          clearInterval(interval);
          initGame();
        } else {
          width += 10;
          progressBar.style.width = width + '%';
        }
      }, 200);
    }

    // Show notification
    function showNotification(message, isSuccess) {
      const titleEl = notificationEl.querySelector('.title');
      const messageEl = notificationEl.querySelector('.message');
      
      titleEl.textContent = isSuccess ? "Correct!" : "Incorrect!";
      messageEl.textContent = message;
      notificationEl.className = "notification show " + (isSuccess ? "success" : "");
      
      setTimeout(() => {
        notificationEl.classList.remove("show");
      }, 3000);
    }

    // Update streak display with multiplier never below 1
    function updateStreak() {
      streakValueEl.textContent = streak;
      
      if (streak === 0) {
        streakTextEl.textContent = "No streak yet";
        streakTextEl.style.color = "#a9a9b3";
        multiplierEl.style.display = 'none';
        streakFire.classList.remove('show');
        streakMultiplier = 1;
      } else if (streak < 3) {
        streakTextEl.textContent = "Getting started!";
        streakTextEl.style.color = "#ffd166";
        multiplierEl.style.display = 'block';
        streakFire.classList.remove('show');
        streakMultiplier = Math.max(1, Math.pow(2, streak - 1));
      } else if (streak < 5) {
        streakTextEl.textContent = "Hot streak!";
        streakTextEl.style.color = "#ff9a00";
        multiplierEl.style.display = 'block';
        streakFire.classList.add('show');
        streakMultiplier = Math.max(1, Math.pow(2, streak - 1));
      } else {
        streakTextEl.textContent = "On fire!";
        streakTextEl.style.color = "#ff3860";
        multiplierEl.style.display = 'block';
        streakFire.classList.add('show');
        streakMultiplier = Math.max(1, Math.pow(2, streak - 1));
      }
      
      // Update multiplier display
      multiplierValueEl.textContent = `${streakMultiplier}x`;
    }

    // Show multiplier animation
    function showMultiplierAnimation() {
      if (streak > 1 && streakMultiplier > 1) {
        multiplierPopup.textContent = `${streakMultiplier}x!`;
        multiplierPopup.classList.add('show');
        
        setTimeout(() => {
          multiplierPopup.classList.remove('show');
        }, 1500);
      }
    }

    // Simplify charge description
    function simplifyCharge(charge) {
      // Split into words
      const words = charge.split(' ');
      
      // Replace abbreviations with simplified terms
      const simplified = words.map(word => {
        // Check for exact matches
        if (simplifiedCharges[word]) {
          return simplifiedCharges[word];
        }
        
        // Check for partial matches
        for (const [abbr, full] of Object.entries(simplifiedCharges)) {
          if (word.includes(abbr)) {
            return full;
          }
        }
        
        return word;
      }).join(' ');
      
      // Remove unnecessary parts
      let result = simplified
        .replace(/\([^)]*\)/g, '') // Remove anything in parentheses
        .replace(/\b(?:Charges|FTA|VOC|MISD|FELONY|CS|SCH|PWIMSD)\b/gi, '')
        .replace(/\.+$/, '') // Remove trailing dots
        .replace(/\s{2,}/g, ' ') // Remove extra spaces
        .trim();
        
      // Capitalize first letter
      return result.charAt(0).toUpperCase() + result.slice(1);
    }

    // Process suspect name
    function processName(nameString) {
      // Remove date from name
      return nameString.replace(/\s\d{2}\/\d{2}\/\d{4}$/, '');
    }

    // Extract charge from crime description
    function extractCharge(crimeDescription) {
      // Find the start of the charges section
      const chargesIndex = crimeDescription.indexOf('Charges');
      if (chargesIndex === -1) return crimeDescription;
      
      // Extract the charges part
      let charges = crimeDescription.substring(chargesIndex + 7).trim();
      
      // Remove "… Read more" if present
      charges = charges.replace('… Read more', '').trim();
      
      // Return only the first charge if multiple exist
      const firstCharge = charges.split(';')[0].trim();
      
      // Remove any trailing dots or extra spaces
      return firstCharge.replace(/\.+$/, '').trim();
    }

    // Fetch mugshots from server with pagination
    async function fetchMugshots(page) {
      try {
        if (!page) page = 1;  // fallback if no page is passed

        const res = await fetch(`http://localhost:3000/wakenc?page=${encodeURIComponent(page)}`);
        
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        
        const data = await res.json();
        
        // Process each mugshot
        const processedMugshots = data.mugshots.map(item => {
          const charge = extractCharge(item.crime);
          return {
            name: processName(item.name),
            img: item.img,
            crime: simplifyCharge(charge),
            rawCrime: item.crime
          };
        });
        
        return {
          page: data.page,
          totalPages: data.totalPages,
          mugshots: processedMugshots
        };
      } catch (error) {
        console.error('Error fetching data:', error);
        showNotification("Failed to load mugshots from server. Using demo data.", false);
        
        // Return the exact fallback data you provided
        const fallbackData = {
          page1: {
            page: 1,
            totalPages: 10,
            mugshots: [
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/wRKGnQWEQctzpK5f4Q5Z.jpg",
                name: "PORTER JOSHUA LOUIS 07/28/2025",
                crime: "Name PORTER, JOSHUA LOUIS Age 40 Sex M Arrested By RALEIGH POLICE DEPARTMENT Charges HIT/RUN LEAVE SCENE PROP DAM",
                link: "https://wakenc.mugshots.zone/porter-joshua-louis-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/1UCGzaKQPkx0PAwZf22i.jpg",
                name: "CHAVARRIA EDGAR IVAN 07/28/2025",
                crime: "Name CHAVARRIA, EDGAR IVAN Age 21 Sex M Arrested By WAKE COUNTY SHERIFF Charges OBTAIN PROPERTY FALSE PRETENSE UTTERING FORGED … Read more",
                link: "https://wakenc.mugshots.zone/chavarria-edgar-ivan-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/ks7226MY94RppFf365r7.jpg",
                name: "LALIN CHRISTOPHER GEOVANNY 07/28/2025",
                crime: "Name LALIN, CHRISTOPHER GEOVANNY Age 24 Sex M Arrested By NC DEPARTMENT OF ADULT CORRECT Charges MISDEMEANOR PROBATION VIOL",
                link: "https://wakenc.mugshots.zone/lalin-christopher-geovanny-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/hKUZTxqQoE2b1A4niddX.jpg",
                name: "SIMMS DREVON JAMEL 07/28/2025",
                crime: "Name SIMMS, DREVON JAMEL Age 22 Sex M Arrested By RALEIGH POLICE DEPARTMENT Charges ROBBERY WITH DANGEROUS WEAPON CONSP ROBBERY … Read more",
                link: "https://wakenc.mugshots.zone/simms-drevon-jamel-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/S9Kowprbt2qyyf8zafxC.jpg",
                name: "CURETON KENDRA KATREECE 07/28/2025",
                crime: "Name CURETON, KENDRA KATREECE Age 50 Sex F Arrested By WAKE COUNTY SHERIFF Charges POSSESS STOLEN FIREARM M/S/D/P CS W/N … Read more",
                link: "https://wakenc.mugshots.zone/cureton-kendra-katreece-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/ENfIsal89tyAParNwK3i.jpg",
                name: "JOYNER RANDALL CLAYTON 07/28/2025",
                crime: "Name JOYNER, RANDALL CLAYTON Age 36 Sex M Arrested By RALEIGH POLICE DEPARTMENT Charges OBTAIN PROPERTY FALSE PRETENSE FINANCIAL CARD … Read more",
                link: "https://wakenc.mugshots.zone/joyner-randall-clayton-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/48IbQkermPF5EmGXAU9J.jpg",
                name: "MITCHELL KHAREE LUCAN 07/28/2025",
                crime: "Name MITCHELL, KHAREE LUCAN Age 47 Sex M Arrested By RALEIGH POLICE DEPARTMENT Charges POSSESS DRUG PARAPHERNALIA M/S/D/P CS W/N … Read more",
                link: "https://wakenc.mugshots.zone/mitchell-kharee-lucan-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/X9lZ6IStZ3G6Va1dUewE.jpg",
                name: "SMITH JOHNNY LEE 07/28/2025",
                crime: "Name SMITH, JOHNNY LEE Age 57 Sex M Arrested By GARNER POLICE DEPARTMENT Charges HABITUAL LARCENY POSSESS DRUG PARAPHERNALIA",
                link: "https://wakenc.mugshots.zone/smith-johnny-lee-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/LeYFNzyV0NSAXsABMUII.jpg",
                name: "MCBRIDE LINDA ANN 07/28/2025",
                crime: "Name MCBRIDE, LINDA ANN Age 63 Sex F Arrested By GARNER POLICE DEPARTMENT Charges BREAKING AND OR ENTERING (F) LARCENY … Read more",
                link: "https://wakenc.mugshots.zone/mcbride-linda-ann-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/lHClpl8cLTWyvsD4YFQp.jpg",
                name: "HOLIDAY DARREN JAY 07/28/2025",
                crime: "Name HOLIDAY, DARREN JAY Age 64 Sex M Arrested By RALEIGH POLICE DEPARTMENT Charges POSSESS STOLEN MOTOR VEHICLE",
                link: "https://wakenc.mugshots.zone/holiday-darren-jay-mugshot-07-28-2025/"
              }
            ]
          },
          page2: {
            page: 2,
            totalPages: 10,
            mugshots: [
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/ENfIsal89tyAParNwK3i.jpg",
                name: "JOYNER RANDALL CLAYTON 07/28/2025",
                crime: "Name JOYNER, RANDALL CLAYTON Age 36 Sex M Arrested By RALEIGH POLICE DEPARTMENT Charges OBTAIN PROPERTY FALSE PRETENSE FINANCIAL CARD … Read more",
                link: "https://wakenc.mugshots.zone/joyner-randall-clayton-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/48IbQkermPF5EmGXAU9J.jpg",
                name: "MITCHELL KHAREE LUCAN 07/28/2025",
                crime: "Name MITCHELL, KHAREE LUCAN Age 47 Sex M Arrested By RALEIGH POLICE DEPARTMENT Charges POSSESS DRUG PARAPHERNALIA M/S/D/P CS W/N … Read more",
                link: "https://wakenc.mugshots.zone/mitchell-kharee-lucan-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/LRpIJKduNwslBOaiL4oM.jpg",
                name: "GERALD SHANE IZEL 07/28/2025",
                crime: "Name GERALD, SHANE IZEL Age 26 Sex M Arrested By WAKE COUNTY SHERIFF Charges FTA-COMMON LAW ROBBERY FTA-COMMON LAW ROB,MISD … Read more",
                link: "https://wakenc.mugshots.zone/gerald-shane-izel-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/X9lZ6IStZ3G6Va1dUewE.jpg",
                name: "SMITH JOHNNY LEE 07/28/2025",
                crime: "Name SMITH, JOHNNY LEE Age 57 Sex M Arrested By GARNER POLICE DEPARTMENT Charges HABITUAL LARCENY POSSESS DRUG PARAPHERNALIA",
                link: "https://wakenc.mugshots.zone/smith-johnny-lee-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/LeYFNzyV0NSAXsABMUII.jpg",
                name: "MCBRIDE LINDA ANN 07/28/2025",
                crime: "Name MCBRIDE, LINDA ANN Age 63 Sex F Arrested By GARNER POLICE DEPARTMENT Charges BREAKING AND OR ENTERING (F) LARCENY … Read more",
                link: "https://wakenc.mugshots.zone/mcbride-linda-ann-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/lHClpl8cLTWyvsD4YFQp.jpg",
                name: "HOLIDAY DARREN JAY 07/28/2025",
                crime: "Name HOLIDAY, DARREN JAY Age 64 Sex M Arrested By RALEIGH POLICE DEPARTMENT Charges POSSESS STOLEN MOTOR VEHICLE",
                link: "https://wakenc.mugshots.zone/holiday-darren-jay-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/BypSSFdmuwQ7v3CO4tHt.jpg",
                name: "WESTBROOK JONATHAN STEPHEN 07/28/2025",
                crime: "Name WESTBROOK, JONATHAN STEPHEN Age 42 Sex M Arrested By GARNER POLICE DEPARTMENT Charges FELONY LARCENY RESISTING PUBLIC OFFICER",
                link: "https://wakenc.mugshots.zone/westbrook-jonathan-stephen-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/eqvc2nD7eb4ZlEkfBrMx.jpg",
                name: "LOBOS BRIAN ROLANDO 07/28/2025",
                crime: "Name LOBOS, BRIAN ROLANDO Age 26 Sex M Arrested By WAKE COUNTY SHERIFF Charges GJI-FEL SERIOUS INJURY BY VEHICLE GJI-FEL … Read more",
                link: "https://wakenc.mugshots.zone/lobos-brian-rolando-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/aZf5NPgAWJnHl71Z6VuH.jpg",
                name: "STANLEY MONTRAIL ANTONYIO 07/28/2025",
                crime: "Name STANLEY, MONTRAIL ANTONYIO Age 25 Sex M Arrested By RALEIGH POLICE DEPARTMENT Charges FAIL RETURN HIRED MV >$4000",
                link: "https://wakenc.mugshots.zone/stanley-montrail-antonyio-mugshot-07-28-2025/"
              },
              {
                img: "https://cdn.mugshots.zone/sites/wakenc/images/2025/07/28/yrc6nomnAehcJ3o5qctT.jpg",
                name: "STANCIL JACQUELYN RENEE 07/28/2025",
                crime: "Name STANCIL, JACQUELYN RENEE Age 42 Sex F Arrested By RALEIGH POLICE DEPARTMENT Charges FUG-CONTEMPT OF COURT(CHESAPEAKE,VA)",
                link: "https://wakenc.mugshots.zone/stancil-jacquelyn-renee-mugshot-07-28-2025/"
              }
            ]
          }
        };

        // Return the appropriate fallback page
        if (page === 1) {
          return fallbackData.page1;
        } else if (page === 2) {
          return fallbackData.page2;
        } else {
          return {
            page: page,
            totalPages: 10,
            mugshots: []
          };
        }
      }
    }

    // Shuffle array
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Show game over screen
    function showGameOver() {
      document.querySelector('.game-container').style.display = 'none';
      gameOverEl.style.display = 'block';
      finalScoreEl.textContent = score;
    }

    // Restart game
    function restartGame() {
      // Reset game state
      current = 0;
      score = 0;
      streak = 0;
      mugshotsShown = 0;
      streakMultiplier = 1;
      usedEliminate = false;
      
      // Reset UI
      scoreEl.textContent = '0';
      streakValueEl.textContent = '0';
      streakTextEl.textContent = 'No streak yet';
      streakTextEl.style.color = '#a9a9b3';
      multiplierEl.style.display = 'none';
      progressBar.style.width = '0%';
      
      // Hide game over screen
      gameOverEl.style.display = 'none';
      
      // Show game container
      document.querySelector('.game-container').style.display = 'block';
      
      // Reset mugshots and reload
      mugshots = [];
      uniqueCrimes.clear();
      simulateProgress();
    }

    // Render current question
    function renderQuestion() {
      if (mugshots.length === 0) return;
      
      const mug = mugshots[current];
      nameEl.textContent = mug.name;
      mugshotEl.src = mug.img;
      mugshotEl.alt = `Mugshot of ${mug.name}`;
      
      const correct = mug.crime;
      
      // Get wrong choices from unique crimes
      let wrongChoices = Array.from(uniqueCrimes).filter(crime => crime !== correct);
      // Shuffle and take 3
      wrongChoices = shuffle(wrongChoices).slice(0, 3);
      
      const allChoices = shuffle([correct, ...wrongChoices]);
      choicesEl.innerHTML = '';
      
      allChoices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.innerHTML = `<div><i class="fas fa-gavel"></i></div><div>${choice}</div>`;
        btn.onclick = () => handleChoice(choice, correct);
        choicesEl.appendChild(btn);
      });
      
      // Enable powerups
      eliminateBtn.disabled = false;
      hintBtn.disabled = false;
      
      // Reset power-up state
      usedEliminate = false;
      
      // Update multiplier display
      updateStreak();
      
      // Update mugshots shown counter
      mugshotCountEl.textContent = mugshotsShown;
      
      // Update progress bar
      const progress = (mugshotsShown / TOTAL_MUGSHOTS) * 100;
      progressBar.style.width = `${progress}%`;
    }

    // Handle choice selection
    async function handleChoice(selected, correct) {
      const buttons = document.querySelectorAll('.choice-btn');
      let correctBtn;
      
      buttons.forEach(btn => {
        if (btn.textContent.includes(correct)) {
          correctBtn = btn;
          btn.classList.add('correct');
        }
        
        if (btn.textContent.includes(selected) && selected !== correct) {
          btn.classList.add('incorrect');
        }
        
        btn.disabled = true;
      });
      
      // Disable powerups during reveal
      eliminateBtn.disabled = true;
      hintBtn.disabled = true;
      
      setTimeout(async () => {
        if (selected === correct) {
          // Calculate points based on streak multiplier (always at least 1)
          const points = streakMultiplier;
          score += points;
          
          // Increase streak
          streak++;
          
          // Update UI
          scoreEl.textContent = score;
          showNotification(`Correct! +${points} points!`, true);
          
          // Show multiplier animation if streak is growing
          if (streak > 1) {
            showMultiplierAnimation();
          }
        } else {
          // Reset streak on incorrect answer
          streak = 0;
          showNotification(`Incorrect! The charge was: ${correct}`, false);
        }
        
        updateStreak();
        
        // Move to next question
        current++;
        mugshotsShown++;  // Increment mugshots shown
        
        // Check if we've reached the total mugshots
        if (mugshotsShown >= TOTAL_MUGSHOTS) {
          showGameOver();
          return;
        }
        
        // Check if we need to load more mugshots
        if (current >= mugshots.length - 3 && currentPage < totalPages) {
          loadingMoreEl.style.display = 'block';
          
          // Load next page
          const nextPage = currentPage + 1;
          const data = await fetchMugshots(nextPage);
          
          // Add new mugshots to our collection
          mugshots = [...mugshots, ...data.mugshots];
          
          // Update unique crimes
          data.mugshots.forEach(mug => uniqueCrimes.add(mug.crime));
          
          // Update page info
          currentPage = nextPage; 
          totalPages = data.totalPages;
          
          // Update UI
          mugshotCountEl.textContent = mugshotsShown;
          currentPageEl.textContent = currentPage;
          totalPagesEl.textContent = totalPages;
          
          loadingMoreEl.style.display = 'none';
        }
        
        // Reset to beginning if we've reached the end
        if (current >= mugshots.length) {
          current = 0;
        }
        
        renderQuestion();
      }, 1500);
    }

    // Eliminate two wrong answers
    eliminateBtn.addEventListener('click', () => {
      if (usedEliminate) return;
      
      const buttons = Array.from(document.querySelectorAll('.choice-btn'));
      const correct = mugshots[current].crime;
      let eliminated = 0;
      
      shuffle(buttons).forEach(btn => {
        if (eliminated < 2 && !btn.textContent.includes(correct) && !btn.classList.contains('eliminated')) {
          btn.style.opacity = '0.3';
          btn.style.transform = 'scale(0.95)';
          btn.disabled = true;
          btn.classList.add('eliminated');
          eliminated++;
        }
      });
      
      usedEliminate = true;
      eliminateBtn.disabled = true;
    });

    // Show hint
    hintBtn.addEventListener('click', () => {
      const crime = mugshots[current].crime;
      // Try to match with famous arrests
      const crimeType = Object.keys(famousArrests).find(type => 
        crime.toLowerCase().includes(type.toLowerCase())
      );
      
      if (crimeType && famousArrests[crimeType]) {
        showNotification(`Hint: ${famousArrests[crimeType]} was arrested for a similar charge.`, true);
      } else {
        // If no direct match, try to find any related hint
        const relatedHint = Object.entries(famousArrests).find(([type]) => 
          type.split(' ').some(word => crime.toLowerCase().includes(word.toLowerCase()))
        );
        
        if (relatedHint) {
          showNotification(`Hint: ${relatedHint[1]} was arrested for a related charge (${relatedHint[0]}).`, true);
        } else {
          showNotification("No hint available for this charge.", false);
        }
      }
      
      // Disable hint after use
      hintBtn.disabled = true;
    });

    // Initialize game
    async function initGame() {
      try {
        // Fetch first page of mugshots
        const data = await fetchMugshots(1);
        mugshots = data.mugshots;
        currentPage = data.page;
        totalPages = data.totalPages;
        
        if (mugshots.length === 0) {
          showNotification("No mugshot data available.", false);
          return;
        }
        
        // Collect unique crimes
        mugshots.forEach(mug => uniqueCrimes.add(mug.crime));
        
        gameStarted = true;
        mugshotsShown = 1;  // First mugshot
        renderQuestion();
        updateStreak();
        mugshotCountEl.textContent = mugshotsShown;
        currentPageEl.textContent = currentPage;
        totalPagesEl.textContent = totalPages;
        
        // Initialize progress bar
        progressBar.style.width = `${(1/TOTAL_MUGSHOTS)*100}%`;
      } catch (error) {
        console.error('Error initializing game:', error);
        showNotification("Failed to initialize game. Please try again later.", false);
      }
    }

    // Add restart button event listener
    restartBtn.addEventListener('click', restartGame);

    // Start the game
    simulateProgress();
  </script>
</body>
</html>
